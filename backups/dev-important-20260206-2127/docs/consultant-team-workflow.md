# 持牌顾问 + 文案/操作员 跟进流程 - 功能安排建议

## 〇、案件与审核的定义（业务约定）

- **案件**：不是「消息」本身，而是**普通用户在与顾问咨询后确定申请，自己填写好移民/留学/旅游等申请资料并提交给顾问**之后形成的申请单。即：**用户已填写的申请资料提交到顾问 = 一个案件**。
- **一个案件内包含**：顾问或文案等人的**跟进**、**发送消息/对话**、**发送文件/图片**，以及**审核**。
- **审核**：顾问或文案等人都可以审核；审核的对象是**用户已填好的申请资料**（即审核该案件下用户提交的资料），不是单纯「标记已读」或「会话已处理」。对外可统一展示为「持牌顾问已审核」。

## 一、实际业务场景

- 会员在平台上**选择的是持牌顾问**（负责主体、对外名义）。
- 日常**跟进沟通、发送文件、填表协助**多由该顾问名下的**文案**或**操作员**完成。
- **持牌顾问**主要做**最终审核、签字或关键节点把关**。

## 二、当前系统已支持的能力

| 环节 | 现状 |
|------|------|
| 会员选顾问 | 会员选择持牌顾问 → `User.assignedRcicId`、案件 `Case.rcicId` 绑定该持牌顾问。 |
| 谁可以跟进 | 持牌顾问（RCIC 端登录）+ 该顾问下的**所有**文案/操作员（Team 端登录）都能看到该顾问的案件、发消息、发文件。 |
| 消息展示 | 文案/操作员发消息时，系统用 `senderId = rcicId`、`senderType = 'rcic'` 存库，**会员端统一显示为「顾问」回复**，不区分是持牌本人还是团队。 |
| 文件 | 通过消息附件或文档接口上传，会员在会员中心可查看。 |

结论：**「由文案/操作员跟进沟通和发送文件、持牌顾问做审核」** 的流程在现有结构下已经可以运作；持牌顾问和团队成员都能在同一批案件上协作，会员侧体验是「和顾问沟通」。

---

## 三、建议的功能增强（按优先级）

### 1. 案件指派给具体跟进人（推荐优先）

**目的**：明确「这个案件主要由哪位文案/操作员跟进」，便于责任到人、避免重复联系会员。

**数据**：

- 在 `Case` 上增加可选字段，例如：`assignedTeamMemberId`（String?，指向 `RCICTeamMember.id`）。
- 不填则表示「未指定跟进人」，该持牌顾问下所有团队成员仍可像现在一样查看和回复。

**功能**：

- **持牌顾问端（RCIC）**：在案件详情或案件列表中，可选择「指派给：李四（文案）」；可改派或清空。
- **Team 端（文案/操作员）**：
  - 可看到「我负责跟进的案件」列表（`assignedTeamMemberId = 当前成员`）与「我所属顾问的全部案件」；
  - 未指派时行为与现在一致（都能看、都能回）。

**会员端**：无需改版；会员仍只看到「顾问」回复，不暴露是持牌本人还是哪位文案。

---

### 2. 会员端展示方式（可选）

**方案 A（推荐，简单）**  
- 保持现状：会员端只显示「顾问」或持牌顾问姓名，不区分持牌本人/团队。  
- 必要时在「消息」或「案件说明」处加一句固定文案：「您的持牌顾问为 XXX，日常由顾问团队为您提供服务与沟通。」

**方案 B（更透明）**  
- 若指派了跟进人，可显示：「您的持牌顾问：张三」「当前由 李四（顾问团队） 为您跟进」。  
- 需要接口在返回案件/会话时带上 `assignedTeamMemberName`（或仅带「顾问团队」角色名），前端多展示一行即可。

建议先做「案件指派」，再视需要选 A 或 B。

---

### 3. 「持牌顾问审核」节点（可选）

**目的**：把「持牌顾问最后审核」做成可识别的节点，便于合规与统计。

**做法**：

- 在 `Case` 上增加状态或审核标记，例如：  
  - `reviewStatus`: `'pending_review' | 'reviewed'`，或  
  - `rcicReviewedAt`: DateTime?（持牌顾问完成审核的时间）。
- **仅持牌顾问**在 RCIC 端可操作「标记为：持牌顾问已审核」；文案/操作员在 Team 端不显示该按钮。
- 会员端可显示为：「待持牌顾问审核」/「持牌顾问已审核」（可选）。

---

### 4. 文件与沟通（保持现状即可）

- 文案/操作员在 **Team 端**：发消息、上传/发送文件，与现在一致。
- 持牌顾问在 **RCIC 端**：可随时查看案件与消息、补充回复或上传材料，并做最终审核。
- 会员在 **会员中心**：收消息、收文件、发消息，不区分发送方是持牌本人还是团队。

---

## 四、实施顺序建议

1. **Phase 1**  
   - 在 `Case` 上增加 `assignedTeamMemberId`（及迁移）。  
   - RCIC 端：案件详情/列表支持「指派给」某位团队成员、改派、清空。  
   - Team 端：列表支持筛选「我负责跟进的案件」。

2. **Phase 2（可选）**  
   - 会员端：按方案 A 或 B 展示「持牌顾问」及（可选）「当前跟进人」说明。

3. **Phase 3（可选）**  
   - Case 增加 `reviewStatus` / `rcicReviewedAt`；  
   - RCIC 端「持牌顾问审核」按钮；  
   - 会员端是否展示「已审核」状态按需求定。

这样安排后：**用户选的仍是持牌顾问，实际由文案/操作员跟进沟通和发文件，持牌顾问做最后审核**，整个流程在功能上清晰、可扩展，且与现有数据模型兼容。

---

## 五、案件创建时机（产品建议）

- **案件**应代表「用户提交的申请」：即用户在与顾问咨询后**确定申请**，**自己填写好移民/留学/旅游等资料并提交给顾问**时，应**创建或关联一个 Case**（type 为对应申请类型，如 study_permit、visitor_visa 等），使该案件真正对应「用户已填写的申请资料」。
- 若当前仅有「咨询会话」时自动创建的 Case（type: consultation），后续产品在「用户从申请页（如学签/访客签）提交已填写的申请资料」时，应增加「创建案件」或「关联到已有案件」的逻辑，以便顾问/文案在该案件下进行跟进、消息、文件与**资料审核**。
